"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[477],{10:function(n){n.exports=JSON.parse('{"blogPosts":[{"id":"/2016/04/08/old-blog-post","metadata":{"permalink":"/blog/2016/04/08/old-blog-post","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2016-04-08-old-blog-post.mdx","source":"@site/blog/2016-04-08-old-blog-post.mdx","title":"\u5982\u4f55\u5b9e\u73b0\u81ea\u5df1\u6ca1\u5b9e\u73b0\u8fc7\u7684\u9700\u6c42\u4e4b\u6587\u672c\u52a8\u753b","description":"\u8fd9\u662f\u4e00\u7bc7\u65e7\u6587, \u5f53\u65f6\u7684\u6587\u98ce\u8fd8\u633a\u4e0d\u4e00\u6837\u7684\u3002","date":"2016-03-17T12:01:00.000Z","formattedDate":"March 17, 2016","tags":[],"readingTime":16.25,"truncated":false,"authors":[],"frontMatter":{"date":"2016-03-17 12:01","status":"public","title":"\u5982\u4f55\u5b9e\u73b0\u81ea\u5df1\u6ca1\u5b9e\u73b0\u8fc7\u7684\u9700\u6c42\u4e4b\u6587\u672c\u52a8\u753b"}},"content":"> \u8fd9\u662f\u4e00\u7bc7\u65e7\u6587, \u5f53\u65f6\u7684\u6587\u98ce\u8fd8\u633a\u4e0d\u4e00\u6837\u7684\u3002\\n\\n\u5927\u5bb6\u597d, \u6b22\u8fce\u6765\u5230\u7f6a\u6076\u5751, \u6211\u662f\u975e\u77e5\u540d\u7a0b\u5e8f\u5458, \u60f3\u8ddf\u5927\u5bb6\u8bf4\u4e00\u6bb5\u4f20\u7edf\u76f8\u58f0\u8282\u76ee, \u989d, \u5bf9\u4e0d\u8d77, \u8bf4\u9519\u4e86\u3002\u60f3\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u70b9\u5173\u4e8e\u6587\u672c\u548c\u52a8\u753b\u7684\u4e1c\u897f\u3002\u8fd9\u4e0d\u662f\u4e00\u7bc7\u7eaf\u8840\u7edf, \u9ad8\u3001\u7cbe\u3001\u5c16\u7684\u6280\u672f\u6587\u7ae0, \u4f46\u4f9d\u7136\u5e0c\u671b\u6709\u4eba\u80fd\u50cf\u559c\u6b22\u6df7\u8840\u7f8e\u5973\u4e00\u6837\u559c\u6b22\u3002\\n\\n## \u524d\u8a00\\n\\n\u8bb0\u5f97\u4ee5\u524d\u770b\u5230\u8fc7\u4e00\u4e2a\u5f88\u8d5e\u7684\u6587\u5b57\u6548\u679c\u7684\u52a8\u753b, \u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a\\n\\n![textanimation](https://cloud.githubusercontent.com/assets/3759810/13845905/1e55a5d0-ec7e-11e5-9631-68aaf6b07ba1.gif)\\n\\n\u5f53\u65f6\u88ab\u60ca\u8273\u5230\u4e86, \u6700\u8fd1\u5076\u7136\u95f4\u53c8\u518d\u6b21\u89c1\u5230, \u4f9d\u7136\u8fd8\u662f\u90a3\u4e48\u559c\u6b22\u3002\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u9700\u8981\u5b9e\u73b0\u8fd9\u6837\u7684\u9700\u6c42\u3002\u4e00\u822c\u78b0\u5230\u9700\u6c42\u6211\u4eec\u90fd\u4f1a\u53bbgithub\u4e0a\u770b\u770b, \u4fd7\u79f0\u627e\u8f6e\u5b50\uff08github\u57fa\u672c\u4e0a\u53ea\u6709\u4f60\u60f3\u4e0d\u5230\u7684, \u5c31\u6ca1\u6709\u5b83\u6ca1\u6709\u7684\uff09\u3002\u5927\u591a\u6570\u60c5\u51b5\u4e0b, \u6ca1\u6709\u95ee\u9898\u3002\u6216\u8005\u8bf4\u6709\u70b9\u5c0f\u95ee\u9898\uff1a\u8f6e\u5b50\u592a\u591a, \u65e0\u4ece\u4e0b\u5634\u3002\\n\\n## \u9009\u62e9\\n\\n>\u9009\u8f6e\u5b50\u5c31\u50cf\u9009\u59d1\u5a18, \u4f60\u4e0d\u77e5\u9053\u540e\u9762\u7b49\u7740\u4f60\u7684\u662f\u4ec0\u4e48 -----\u7f6a\u6076\u5751\u5c0f\u7a0b\u5982\u662f\u8bf4\\n\\n\u7a0b\u5e8f\u5458\u6c5f\u6e56, \u6bcf\u4f4d\u5927\u4fa0\u7684\u6b66\u529f\u548c\u5957\u8def\u4e0d\u5c3d\u4e00\u6837, \u5c11\u6797, \u6b66\u5f53, \u6606\u4ed1\u5404\u95e8\u5404\u6d3e, \u767e\u82b1\u4e89\u8273\u3002\u5b9e\u73b0\u8f6e\u5b50\u7684\u601d\u8def\u81ea\u7136\u4e5f\u4e0d\u4e00\u6837\u3002\u6709\u7684\u8f6e\u5b50\u9ad8\u6df1\u6666\u6da9\u96be\u61c2, \u529f\u80fd\u5f3a\u5927, \u6709\u7684\u6e05\u6670\u660e\u4e86, \u529f\u80fd\u7b80\u5355\u3002\u4e0d\u8fc7\u6709\u4e00\u70b9\u76f8\u540c\u662f, \u9009\u9519\u4e86\u5c31\u4f1a\u88ab\u5751, \u53ea\u662f\u5751\u5927\u5751\u5c0f\u95ee\u9898\u3002\u9009\u8f6e\u5b50\u81ea\u7136\u9700\u8981\u65e0\u6bd4\u8c28\u614e, \u65e2\u8981\u5339\u914d\u9700\u6c42\u540c\u65f6\u4e5f\u8981\u80fd\u5728\u6389\u5751\u91cc\u7684\u65f6\u5019\u586b\u4e0a\uff08\u5e9f\u8bdd, \u51fabug\u4e86, \u4f60\u4e0d\u586b, \u8c01\u586b\uff09, \u8981\u80fdhold\u4f4f\u3002\u7136\u800c\u586b\u5751\u54ea\u80fd\u90a3\u4e48\u7b80\u5355\u5462, \u9996\u5148\u8f6e\u5b50\u5b9e\u73b0\u601d\u8def, \u4ee3\u7801\u7684\u7ed3\u6784, \u8fd0\u884c\u65f6\u5e8f\u4f60\u8981\u641e\u6e05\u695a\u5427, \u63d0\u4f9b\u4e86\u54ea\u4e9b\u529f\u80fd, \u6ca1\u63d0\u4f9b\u54ea\u4e9b\u529f\u80fd, \u4f60\u8981\u4e86\u89e3\u5427\u3002\u57fa\u672c\u4e0a\u4e00\u4e2a\u590d\u6742\u70b9\u7684\u8f6e\u5b50, \u7814\u7a76\u4e0b\u6765\u5c31\u8981\u597d\u4e9b\u65f6\u95f4\u4e86\u3002\u8fd9\u8fd8\u4e0d\u5305\u62ec\u4f60\u5f00\u4f1a, \u6c9f\u901a, \u89e3bug, \u559d\u8336, \u5012\u6c34, \u4e0a\u5395\u6240, \u62bd\u70df, \u9a82\u5a18, \u5410\u69fd\u4ea7\u54c1\u9700\u6c42\u7684\u65f6\u95f4\u3002\u6240\u4ee5, \u59b9\u5b50\u4eec, \u4e0d\u8981\u95ee\u6211\u4eec\u4eca\u5929\u52a0\u4e0d\u52a0\u73ed, \u8981\u95ee\u4eca\u5929\u80fd\u4e0d\u80fd\u5728\u4f60\u7761\u524d\u4e0b\u73ed\u3002\uff08\u9879\u76ee\u5feb\u4e0a\u7ebf\u4e86, \u5c0f\u7a0b\u4e0d\u52a0\u73ed\u8c01\u52a0\u73ed\u3002\u55ef\u54fc\u3002\uff09\\n\\n## \u521b\u9020\\n> \u5982\u679c\u80fd\u7528\u4ee3\u7801\u626e\u6f14\u4e0a\u5e1d\u8bdd, \u82cd\u8001\u5e08\u7684\u91cf\u4ea7\u4e0d\u662f\u95ee\u9898, \u5c31\u770b\u4ea7\u54c1\u7ecf\u7406\u5b9a\u7684\u9700\u6c42\u662f\u62df\u7269\u8fd8\u662f\u6241\u5e73\u3002----\u7f6a\u6076\u5751\u5c0f\u7a0b\u5982\u662f\u8bf4\\n\\n\u65e2\u7136\u9009\u8f6e\u5b50\u7684\u65f6\u95f4\u6210\u672c\u4e5f\u4e0d\u4f4e, \u90a3\u6709\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u9020\u4e00\u4e2a\u8f6e\u5b50\u3002\u5176\u5b9e\u5199\u4e00\u4e2a\u7684\u597d\u5904\u4e5f\u591a, \u6709\u6210\u5c31\u611f, \u5199\u597d\u4e86\u53ef\u4ee5\u5439\u725b\u903c, \u5199\u574f\u4e86\u586b\u5751\u901f\u5ea6\u5feb\u3002\u4f46\u95ee\u9898\u662f, \u4ee5\u524d\u6ca1\u5199\u8fc7\u600e\u4e48\u529e\uff1f\u6ca1\u628a\u63e1\u600e\u4e48\u529e\uff1f\u6bd4\u5982\u6211\u4eec\u73b0\u5728\u9700\u8981\u5b9e\u73b0\u4e0a\u9762\u7684\u6587\u5b57\u6548\u679c, \u4f46\u662f\u53c8\u4e0d\u77e5\u9053\u600e\u4e48\u5199, \u600e\u4e48\u529e\uff1f\\n\u6ca1\u5173\u7cfb, \u4e0a\u5e1d\u521b\u9020\u4e16\u95f4\u4e5f\u5206\u4e86\u4e03\u6b65\u8d70, \u8ddf\u7740\u8fd9\u4f4d\u5e26\u5934\u5927\u54e5\u540e\u9762\u5b66, \u603b\u4e0d\u4f1a\u9519\u7684\u3002\\n\\n## \u5f00\u59cb\\n\\n   > \u7f57\u9a6c\u4e0d\u662f\u4e00\u5929\u5efa\u6210\u7684, \u6bdb\u7247\u4e0d\u662f\u4e00\u6b21\u6027\u62cd\u5b8c\u7684 ----\u7f6a\u6076\u5751\u5c0f\u7a0b\u5982\u662f\u8bf4\\n\\n\u54a6, \u597d\u50cf\u626f\u5f97\u6709\u70b9\u591a\u4e86\u3002\u5bf9\u4e0d\u8d77, \u73b0\u5728\u5f00\u59cb\u6b63\u5f0f\u62cd\uff08\u82cd\u8001\u5e08\u51c6\u5907\u4e0b, \u5c0f\u7a0b\u4e5f\u51c6\u5907\u4e0b, Action\uff09\uff1a\\n\\n#### 1. \u5206\u89e3\u4efb\u52a1\\n\\n\u901a\u8fc7\u7b80\u5355\u89c2\u5bdf\u6211\u4eec\u53ef\u4ee5\u9a6c\u4e0a\u77e5\u9053, \u4e0a\u9762\u90a3\u4e2a\u52a8\u753b\u6548\u679c\u662f\u901a\u8fc7\u5bf9\u6bcf\u4e2a\u5b57\u7b26\u505a\u52a8\u753b\u5b8c\u6210\u7684\u3002\u800c\u5728iOS\u91cc, \u6587\u672c\u663e\u793a\u63a7\u4ef6\u6700\u5e38\u89c1\u548c\u5e38\u7528\u7684\u662fUILabel\u3002\u800ciOS\u7684Explicit Animation\u6709Properties Animation\u548ckeyframe Animation\u4e24\u79cd\u3002\\n\\n\u4f46\u662fUILabel\u63a7\u4ef6\u6ca1\u6709\u63d0\u4f9b\u5bf9\u5176Text\u4e2d\u6bcf\u4e2a\u5b57\u7b26\u7684\u63a7\u5236\u7684\u529f\u80fd, \u6211\u4eec\u9700\u8981\u6539\u9020\u4e0b\u3002\u65e2\u7136\u8981\u5bf9\u6bcf\u4e2a\u5b57\u7b26\u505a\u52a8\u753b, \u90a3\u5c11\u4e0d\u4e86\u9700\u8981`frame`, `bounds`, `position`, `transform`, \u8fd9\u4e9b\u5c5e\u6027\u3002\\n\u8fd9\u6837\u770b\u6765\u6211\u4eec\u9700\u8981\u4e24\u4e2a\u6b66\u5668\uff1a\u4e00\u4e2a\u505a\u6392\u7248\u529f\u80fd\u7684framework, \u4e0d\u7528\u8bf4, \u80af\u5b9a\u662f[TextKit](http://objccn.io/issue-5-1/)\u3002\u800c\u53e6\u4e00\u4e2a\u662f\u80fd\u663e\u793a\u5355\u4e2a\u5b57\u7b26\u4e5f\u62e5\u6709`frame`, `bounds`, `position`, `transform`\u7b49\u5c5e\u6027\u7684\u7c7b, \u5f88\u81ea\u7136, \u6211\u4eec\u60f3\u5230`CATextLayer`\u3002\\n\\n#### 2. **\u5148\u89e3\u51b3\u6587\u672c\u5e03\u5c40**\\n\\nTextKit\u91cc\u4e3b\u8981\u662f\u4e09\u4e2a\u7c7b`NSTextStorage`, `NSLayoutManager`, `NSContainer`\u3002\u5b83\u4eec\u4e00\u8d77\u5e2e\u7ec4\u6211\u4eec\u89e3\u51b3\u6587\u5b57\u5e03\u5c40, \u6392\u7248\u7684\u5de5\u4f5c\u3002\\n\\n- **NSTextStorage**\uff1a`NSMutableAttributedString`\u7684\u5b50\u7c7b, \u6301\u6709\u6587\u5b57\u5185\u5bb9, \u5f53\u5b57\u7b26\u53d1\u751f\u6539\u53d8\u65f6, \u901a\u77e5`NSLayoutManager`\u5bf9\u8c61\\n  \\n- **NSLayoutManager**: \u6211\u4eec\u7684\u7537\u4e3b\u89d2, \u4ece`NSTextStorage`\u91cc\u83b7\u53d6\u6587\u5b57\u5185\u5bb9\u540e, \u8f6c\u6362\u6210\u5bf9\u5e94\u7684glyph, \u6839\u636e`NSTextContainer`\u7684visible Region\u663e\u793aglyph\u3002\\n  \\n- **NSContainer**: \u786e\u5b9a\u4e00\u4e2aregion\u6765laid out text\u3002\u8fd9\u4e2aregion\u88ab`NSLayoutManager`\u7528\u6765\u51b3\u5b9a\u54ea\u91cc\u53ef\u4ee5break lines\\n\\n\u4e0d\u8fc7\u53ef\u60dcUILabel\u6ca1\u6709\u8fd9\u4e09\u4e2a\u7c7b\u4f5c\u4e3a\u81ea\u5df1\u7684\u5c5e\u6027\u5bf9\u8c61, \u6211\u4eec\u9700\u8981\u81ea\u5df1\u89e3\u51b3\uff1a\\n\\n```swift\\nclass TextAnimationLabel: UILabel,NSLayoutManagerDelegate {   \\n     let textStorage:NSTextStorage = NSTextStorage(string: \\"\\")\\n     let textLayoutManager:NSLayoutManager = NSLayoutManager()\\n     let textContainer:NSTextContainer = NSTextContainer()\\n}\\n```\\n\\n\u9664\u6b64\u4ee5\u5916\u6211\u4eec\u8fd8\u9700\u8981\u4e24\u4e2aArray\u7528\u6765\u4fdd\u5b58\u6587\u672c\u53d8\u6362\u524d\u7684\u65e7\u5b57\u7b26\u548c\u53d8\u6362\u540e\u7684\u65b0\u5b57\u7b26:\\n\\n```swift\\nvar oldCharacterTextLayers:[CATextLayer] = [] \\nvar newCharacterTextLayers:[CATextLayer] = []\\n```\\n\\n\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u7528\u6211\u4eec\u81ea\u5df1\u7684textStorage\u5bf9\u8c61, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u8986\u76d6text\u548cattributedText\u7b49\u5c5e\u6027\u3002\\n\\n```swift\\noverride var text:String! {\\n    get {\\n        return super.text\\n    }\\n    set {\\n        super.text = text\\n        let attributedText = NSMutableAttributedString(string: newValue)\\n        let textRange = NSMakeRange(0,newValue.characters.count)\\n        attributedText.setAttributes([NSForegroundColorAttributeName:self.textColor], range: textRange)\\n        attributedText.setAttributes([NSFontAttributeName:self.font], range: textRange)\\n        let paragraphyStyle = NSMutableParagraphStyle()\\n        paragraphyStyle.alignment = self.textAlignment\\n        attributedText.addAttributes([NSParagraphStyleAttributeName:paragraphyStyle], range: textRange)\\n        self.attributedText = attributedText\\n        }\\n        \\n }\\n    \\noverride var attributedText:NSAttributedString! {\\n    get {\\n        return self.textStorage as NSAttributedString\\n    }\\n    set{\\n        cleanOutOldCharacterTextLayers()\\n        oldCharacterTextLayers = Array(newCharacterTextLayers)\\n        textStorage.setAttributedString(newValue)\\n        self.startAnimation { () -> () in\\n        }\\n            self.endAnimation(nil)\\n    }\\n}\\n```\\n\\n\u5f53TextStorage\u7684\u6587\u672c\u5185\u5bb9\u6539\u53d8\u65f6, \u4f1a\u89e6\u53d1\u4e00\u4e2a\u901a\u77e5send textLayoutManager\u4ee5\u4fbf\u91cd\u65b0\u5e03\u5c40\u6392\u7248\u3002\u663e\u7136\u6211\u4eec\u53ef\u4ee5\u5728\u6392\u7248\u5e03\u5c40\u5b8c\u6210\u540e\u6765\u4e3a\u6bcf\u4e2a\u5b57\u7b26\u521b\u5efa\u8bbe\u7f6e\u4e00\u4e2aCATextLayer, \u5e76\u8bbe\u7f6e\u76f8\u5e94\u7684frame\u4ee5\u4fbf\u6b63\u786e\u7684\u663e\u793a\u5185\u5bb9\u3002\u6211\u4eec\u53ef\u4ee5\u6709\u4e2a\u51fd\u6570\u6765\u5b8c\u6210\u8ba1\u7b97\u3002\u5e76\u4e14layout finish\u5b8c\u6210\u65f6\u8c03\u7528\u3002\\n\\n```swift\\n    // Mark:NSLayoutMangerDelegate\\n    func layoutManager(layoutManager: NSLayoutManager, didCompleteLayoutForTextContainer textContainer: NSTextContainer?, atEnd layoutFinishedFlag: Bool) {\\n            calculateTextLayers()\\n            print(\\"\\\\(textStorage.string)\\")\\n    }\\n        \\n        \\n    // MARK:CalculateTextLayer\\n    func calculateTextLayers()\\n    {\\n    }\\n```\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u7684\u4e3b\u8981\u60f3\u6cd5, \u662f\u627e\u5230text\u91cc\u6bcf\u4e2acharacter\u4ee5\u53ca\u5bf9\u5e94\u7684glyph rect.\u7136\u540e\u7528character\u548cglyph rect\u521b\u5efaCATextLayer\\n\\n\u9996\u5148\u6211\u4eec\u8981\u6709\u4e00\u4e2a\u7a7a\u6570\u7ec4\u7528\u6765\u5b58\u653e\u65b0\u7684CATextLayer\u3002\u5e76\u4e14\u83b7\u53d6textStorage\u7684attributedText\u3002\\n\\n```swift\\nfunc calculateTextLayers()\\n{\\n newCharacterTextLayers.removeAll(keepCapacity:false)\\n let attributedText = textStorage.string\\n}\\n\\n```\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u901a\u8fc7LayoutManger\u627e\u5230TextContainer\u7684used Rect, \u8fd9\u6837\u65b9\u4fbf\u6211\u4eec\u53ef\u4ee5\u8ba9\u6587\u672c\u5782\u76f4\u5c45\u4e2d, \u5c31\u50cf\u666e\u901a\u7684Label\u90a3\u6837\u3002\\n\\n```swift\\nfunc calculateTextLayers()\\n{\\n newCharacterTextLayers.removeAll(keepCapacity:false)\\n let attributedText = textStorage.string\\n let wordRange = NSMakeRange(0, attributedText.characters.count)\\n    let attributedString = self.internalAttributedText();\\n    let layoutRect = textLayoutManager.usedRectForTextContainer(textContainer)\\n    var index = wordRange.location\\n    let totalLength = NSMaxRange(wordRange)\\n    while index < totalLength {\\n         ...\\n    }\\n}\\n\\n```\\n\\n\u73b0\u5728\u6211\u4eec\u5f00\u59cb\u8fed\u4ee3\u5904\u7406\u6587\u672c\u91cc\u7684\u6bcf\u4e2a\u5b57\u7b26, \u521b\u5efa\u4e00\u4e2aglyphRange \u5e76\u4e14\u7528\u8fd9\u4e2aglyphRange\u627e\u5230\u5bf9\u5e94\u7684character, \u7136\u540e\u6211\u4eec\u5c06glyph index\u4e22\u7ed9LayoutManager\u5f97\u5230textContainer, \u518d\u7528container\u548cglyphRange\u53d6\u5f97glyphRect(\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e0bkerning\u7684\u95ee\u9898)\u3002\\n\\n```swift\\nlet glyphRange = NSMakeRange(index, 1)\\nlet characterRange = textLayoutManager.characterRangeForGlyphRange(glyphRange, actualGlyphRange: nil)\\nlet textContainer = textLayoutManager.textContainerForGlyphAtIndex(index, effectiveRange: nil)\\nvar glyphRect = textLayoutManager.boundingRectForGlyphRange(glyphRange, inTextContainer: textContainer!)\\n\\n```\\n\\n\u6700\u7ec8\u6211\u4eec\u8fd8\u9700\u8981\u6ce8\u610f\u7684\u5c31\u662fglyph\u7684kerning, \u5982\u679ckerningRange.location == index, \u6211\u4eec\u9700\u8981\u5c06\u524d\u4e00\u4e2atextLayer\u53d6\u51fa\u6765\u8c03\u6574\u5176Rect\u7684\u5bbd\u5ea6\u81f3\u65b0\u7684glyphRect\u7684\u6700\u53f3\u8fb9, \u4fdd\u8bc1glyph\u4e0d\u4f1a\u88ab\u88c1\u5207\u6389\uff08\u53ef\u4ee5\u5bf9\u6bd4\u4e0b\u9762\u4e24\u5f20\u56fe\u7247\uff09\\n\\n\\n![img](https://cloud.githubusercontent.com/assets/3759810/13854816/4a6b5258-eca8-11e5-9870-15ed2d4f0d70.png)\\n\\n![img](https://cloud.githubusercontent.com/assets/3759810/13854821/4c5b947e-eca8-11e5-811e-e9abb161345f.png)\\n\\n```swift\\nlet kerningRange = textLayoutManager.rangeOfNominallySpacedGlyphsContainingIndex(index)\\nif kerningRange.location == index && kerningRange.length > 1 {\\n        if newCharacterTextLayers.count > 0 {\\n            //\u5982\u679c\u524d\u4e00\u4e2atextlayer\u7684frame.size.width\u4e0d\u53d8\u5927\u7684\u8bdd, \u5f53\u524d\u7684textLayer\u4f1a\u906e\u6321\u4f4f\u5b57\u4f53\u7684\u4e00\u90e8\u5206, \u6bd4\u5982\u201cYes\u201d\u7684Y\u53f3\u4e0a\u89d2\u4f1a\u88ab\u5207\u6389\u4e00\u90e8\u5206\\n                            let previousLayer = newCharacterTextLayers[newCharacterTextLayers.endIndex - 1]\\n                            var frame = previousLayer.frame\\n                    frame.size.width += CGRectGetMaxX(glyphRect) - CGRectGetMaxX(frame)\\n                    previousLayer.frame = frame\\n     }\\n}\\n\\n```\\n\\n\u8fd9\u91cc\u5173\u4e8ekerning\u548cglyph\u8981\u591a\u8bf4\u4e00\u70b9\u3002\u5148\u6765\u8bf4\u4e0bglyph, \u7b80\u5355\u6765\u8bf4glyph\u662f\u8868\u793a\u4e00\u4e2acharacter\u7684\u5177\u4f53\u6837\u5f0f,\u4f46\u4ed6\u4eec\u5374\u4e0d\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb, \u6bd4\u5982\u4e00\u4e2a\u5b57\u6bcd\\"A\\"\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u5199\u6cd5\u6765\u8868\u793a\u4f8b\u5982\uff1a\\n\\n![img](https://cloud.githubusercontent.com/assets/3759810/13878224/e142bef8-ed4a-11e5-9c84-798cb5939f36.png)\\n\\n\u9664\u6b64\u4ee5\u5916, \u8fd8\u6709\u8fd9\u79cd\u60c5\u51b5\uff1a\\n\\n![img](https://cloud.githubusercontent.com/assets/3759810/13878392/fab15e02-ed4b-11e5-9d38-2dc00ed45b0b.png)\\n\\n\u4e0a\u9762\u662f\u7684\\"ff\\"\u867d\u7136\u662f\u4e24\u4e2acharacter, \u4f46\u662fglyph\u5374\u662f\u4e00\u4e2a\u3002\\n\u4e0d\u8fc7\u4e0d\u7528\u62c5\u5fc3, \u5f3a\u5927LayoutManager\u63d0\u4f9b\u4e86\u4e24\u4e2a\u65b9\u6cd5\u5e2e\u52a9\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u627e\u5230\u5bf9\u5e94\u53e6\u5916\u90a3\u4e2a\u3002\\n\\n```swift\\n    func characterIndexForGlyphAtIndex(_ glyphIndex: Int) -> Int\\n    func glyphIndexForCharacterAtIndex(_ charIndex: Int) -> Int\\n```\\n\\n\u73b0\u5728\u6211\u4eec\u8bf4\u4e0bkerning\u3002\u901a\u5e38, \u5728\u6c34\u5e73\u6392\u5e03\u7684\u6587\u672c\u4e2d, glyph\u90fd\u662f\u4e00\u4e2a\u6328\u7740\u4e00\u4e2a\u653e\u7f6e\u7684, \u4f46\u662f\u5728\u67d0\u4e9b\u65f6\u5019\u4e3a\u4e86\u8ba9\u6587\u672c\u7684\u53ef\u8bfb\u6027\u66f4\u597d, \u770b\u4e0a\u53bb\u66f4\u52a0\u4f18\u96c5\u7f8e\u89c2, \u4e00\u4e2a\u5b57\u5f62\u548c\u53e6\u5916\u4e00\u4e2a\u5b57\u5f62\u4e4b\u95f4\u53ef\u80fd\u4f1a\u7a0d\u5fae\u7684\u9519\u4f4d\u4e0b, \u6bd4\u5982\u4e0b\u9762\u8fd9\u79cd\u60c5\u51b5\uff1a\\n\\n![img](https://cloud.githubusercontent.com/assets/3759810/13878767/7631a33c-ed4e-11e5-9d03-46d89d8af9c8.png)\\n\\n\u8fd9\u4e5f\u662f\u4e0a\u9762\u4e3a\u4ec0\u4e48\u201dY\u201c\u4f1a\u51fa\u73b0\u663e\u793a\u4e0d\u5168\u7684\u539f\u56e0\u4e86\u3002\\n\\n\u63a5\u4e0b\u6765\u5c31\u6bd4\u8f83\u7b80\u5355\u4e86, \u521b\u5efaTextlayer,\u8bbe\u7f6e\u5782\u76f4\u5c45\u4e2d, \u6dfb\u52a0\u5230\u6570\u7ec4\u5f53\u4e2d, index+= characterRange.length, \u5f00\u59cb\u4e0b\u6b21\u5faa\u73af\\n\\n```swift\\nglyphRect.origin.y += (self.bounds.size.height/2)-(layoutRect.size.height/2)\\nlet textLayer = CATextLayer(frame: glyphRect, string: attributedString.attributedSubstringFromRange(characterRange));\\nlayer.addSublayer(textLayer);\\nnewCharacterTextLayers.append(textLayer);\\nindex += characterRange.length\\n\\n```\\n\\n#### 3. **\u52a8\u753b\u5b9e\u73b0**\\n\\n\u4e0a\u9762\u6211\u4eec\u89e3\u51b3\u4e86\u5b57\u7b26\u6392\u7248\u7684\u95ee\u9898, \u63a5\u4e0b\u6765\u52a8\u753b\u7684\u5b9e\u73b0\u5c31\u76f8\u5bf9\u7684\u5bb9\u6613\u4e86, \u4ed4\u7ec6\u89c2\u5bdf\u90a3\u4e2a\u52a8\u753b, \u5f88\u5bb9\u6613\u5f97\u51fa\u4e3b\u8981\u662f\u5bf9`opacity `\u548c`transform`\u4e24\u4e2a\u5c5e\u6027\u505a\u5c5e\u6027\u52a8\u753b, `opacity`\u8ba9\u6bcf\u4e2a\u5b57\u4f53\u9010\u6e10\u663e\u793a\u548c\u9010\u6e10\u6d88\u5931, \u800c`transform`\u5219\u505a\u4e86\u4e24\u79cd\u53d8\u5f62, \u4e00\u79cd\u662f\u5f80\u4e0b\u79fb\u52a8,\u53e6\u5916\u4e00\u79cd\u662f\u65cb\u8f6c\u3002\u7528`CABasicAnimation`\u53ef\u4ee5\u89e3\u51b3\u5355\u4e2a\u5c5e\u6027\u52a8\u753b, \u800c`CAAnimationGroup`\u5219\u5e2e\u6211\u4eec\u89e3\u51b3\u591a\u4e2a\u52a8\u753b\u53e0\u52a0\u7684\u590d\u5408\u6548\u679c\u3002\\n\\n```\\nfunc groupAnimationWithLayerChanges(old olderLayer:CALayer, new newLayer:CALayer) -> CAAnimationGroup? {\\n\\n    var animationGroup:CAAnimationGroup?\\n    var animations:[CABasicAnimation] = [CABasicAnimation]()\\n\\n    if !CATransform3DEqualToTransform(olderLayer.transform,\\n    newLayer.transform) {\\n         let basicAnimation = CABasicAnimation(keyPath: \\"transform\\")\\n         basicAnimation.fromValue = NSValue(CATransform3D: olderLayer.transform)\\n         basicAnimation.toValue = NSValue(CATransform3D: newLayer.transform)\\n         animations.append(basicAnimation)\\n         }\\n\\n    if olderLayer.opacity != newLayer.opacity {\\n       let basicAnimation = CABasicAnimation(keyPath: \\"opacity\\")\\n       basicAnimation.fromValue = olderLayer.opacity\\n       basicAnimation.toValue = newLayer.opacity\\n       animations.append(basicAnimation)\\n       }\\n\\n    if animations.count > 0 {\\n       animationGroup = CAAnimationGroup()\\n       animationGroup!.animations = animations\\n   }\\n\\n}\\n\\n```\\n\\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e00\u4e2a\u95ee\u9898, \u5c31\u662f\u9690\u5f0f\u52a8\u753b\u7684\u95ee\u9898, Core Animation\u57fa\u4e8e\u4e00\u4e2a\u5047\u8bf4, \u5c31\u662f\u5c4f\u5e55\u4e0a\u7684\u4efb\u4f55\u4e1c\u897f\u90fd\u53ef\u4ee5(\u6216\u8005\u53ef\u80fd)\u505a\u52a8\u753b, \u6211\u4eec\u5e73\u65f6\u5728\u5199\u4ee3\u7801\u65f6\u5e94\u8be5\u6709\u8fd9\u79cd\u5370\u8c61\u5c31\u662f\u4f60\u53ea\u662flayer\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u503c, \u6ca1\u6709\u6dfb\u52a0\u52a8\u753b, \u4f46\u662f\u4f60\u4f1a\u770b\u5230\u4e00\u4e2a\u5e73\u6ed1\u8fc7\u6e21\u7684\u663e\u793a\u6548\u679c\u800c\u4e0d\u662f\u975e\u5e38\u7a81\u5140\u7684\u53d8\u5316\u3002\u8fd9\u5c31\u662f\u9690\u5f0f\u52a8\u753b\u3002\u5f53\u6211\u4eec\u6539\u53d8\u4e00\u4e2a\u5c5e\u6027\u65f6, Core Animation\u5e2e\u6211\u4eec\u505a\u4e86\u4e00\u4e2a\u52a8\u753b, \u52a8\u753b\u65f6\u95f4\u53d6\u51b3\u4e8e\u5f53\u524dNSTransaction\u7684\u8bbe\u7f6e, \u800c\u52a8\u753b\u7c7b\u578b\u53d6\u51b3\u4e8e\u56fe\u5c42\u884c\u4e3a\u3002\\n\\n\u8fd9\u91cc\u6709\u4e2a\u6709\u8da3\u7684\u4e1c\u897f, \u591a\u8bf4\u4e00\u70b9, \u5c31\u662f\u5f53\u6211\u4eec\u5bf9UIView\u5173\u8054\u7684\u56fe\u5c42\u505a\u52a8\u753b\u800c\u4e0d\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u56fe\u5c42\u505a\u52a8\u753b, \u6bd4\u5982\\n\\n```swift\\nfunc changeColor()\\n{\\n    CATransaction.begin();\\n    CATransaction.setAnimationDuration(1.0)\\n    CGFloat red = CGFloat(arc4random() / (CGFloat)INT_MAX);\\n    CGFloat green = CGFloat(arc4random() / (CGFloat)INT_MAX);\\n    CGFloat blue = CGFloat(arc4random() / (CGFloat)INT_MAX);\\n    self.layerView.layer.backgroundColor = UIColor.(colorWithRed:red green:green blue:blue alpha:1.0).CGColor;\\n    CATransaction.commit();\\n}\\n\\n```\\n\\n\u56fe\u5c42\u7684\u989c\u8272\u77ac\u95f4\u5207\u6362\u5230\u65b0\u7684\u503c, \u800c\u4e0d\u662f\u4e4b\u524d\u7684\u5e73\u6ed1\u8fc7\u6e21, \u9690\u5f0f\u52a8\u753b\u4f3c\u4e4e\u7ed9\u5173\u95ed\u4e86\u3002\\n\u6211\u4eec\u77e5\u9053UIView\u548cCALayer\u6700\u91cd\u8981\u7684\u5173\u7cfb\u5c31\u662fUIView\u662fCALayer\u7684delegate, \\n\u5f53\u6211\u4eec\u6539\u53d8CALayer\u7684\u5c5e\u6027\u65f6, \u5b83\u4f1a\u8c03\u7528 `func actionForKey(_ event: String) -> CAAction?` \u8fd9\u4e2a\u65b9\u6cd5, \u63a5\u4e0b\u6765\u53d1\u751f\u7684\u4e8b\u60c5\u5728\u5b98\u65b9\u6587\u6863\u91cc\u90fd\u6709\u5199, \u5b9e\u9645\u4e0a\u662f\u5982\u4e0b\u51e0\u6b65:\\n\\n- *If the layer has a delegate that implements the actionForLayer:forKey: method, the layer calls that method. The delegate must do one of the following:*\\n\\n      1. Return the action object for the given key.\\n\\n      2. Return the NSNull object if it does not handle the action.\\n\\n- *The layer looks in the layer\u2019s actions dictionary for a matching key/action pair.*\\n- *The layer looks in the style dictionary for an actions dictionary for a matching key/action pair.*\\n- *The layer calls the defaultActionForKey: class method to look for any class-defined actions.*\\n\\nUIView\u4f5c\u4e3a\u5b83\u5173\u8054\u56fe\u5c42\u7684Delegate, \u5b9e\u73b0\u4e86 `actionForLayer(_ layer: CALayer, forKey event: String) -> CAAction?` , \u5f53\u4e0d\u5728\u4e00\u4e2a\u52a8\u753b\u5757\u4e2d, UIView\u8fd4\u56denil, \u800c\u5728\u52a8\u753b\u5757\u4e2d\u5219\u8fd4\u56de\u4e00\u4e2a\u975e\u7a7a\u503c\\n\\n```swift\\nprint(\\"OutSide:\\\\(self.view.actionForLayer(self.view.layer, forKey: \\"backgroundColor\\"))\\")\\nUIView.beginAnimations(nil, context: nil)\\nprint(\\"InSide:\\\\(self.view.actionForLayer(self.view.layer,\\nforKey: \\"backgroundColor\\"))\\")\\nUIView.commitAnimations()\\n```\\n\\n\u663e\u793a\u7ed3\u679c\u5982\u4e0b\\n\\n```swift\\nOutSide:Optional(<null>)\\nInSide:Optional(<CABasicAnimation: 0x7f7f93ff81b0>)\\n```\\n\\n\u5f53\u7136\u8fd4\u56denil\u5e76\u4e0d\u662f\u7981\u7528\u9690\u5f0f\u52a8\u753b\u7684\u552f\u4e00\u65b9\u6cd5, \u4e0b\u9762\u8fd9\u6837\u4e5f\u884c\\n\\n```\\nCATransaction.setDisableActions(true)\\n```\\n\\n\u90a3\u4e3a\u4ec0\u4e48\u8bf4\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u56e0\u4e3a\u6211\u4eec\u5728\u5bf9\u6bcf\u4e2a\u5b57\u7b26\u505a\u52a8\u753b\u7684\u65f6\u5019\u9700\u8981\u5148\u5c06\u9690\u5f0f\u52a8\u753b\u5173\u95ed, \u5426\u8005\u5c06\u4f1a\u505a\u4e24\u6b21\u52a8\u753b, \u6bd4\u5982\u4e0b\u9762\u8fd9\u6837:\\n\\n![closeimplicitanimation](https://cloud.githubusercontent.com/assets/3759810/13857496/2443d70a-ecb5-11e5-8661-a499e9c8719d.gif)\\n\\n\u90a3\u4e48, \u6211\u4eec\u5148\u751f\u6210\u4e00\u4efdoldlayer,\u7136\u540e\u6539\u53d8\u76f8\u5e94\u7684\u5c5e\u6027, \u751f\u4ea7\u65b0\u7684newLayer\u3002\u7136\u540e\u521b\u5efa\u76f8\u5e94\u7684\u52a8\u753b\u7ec4, \u6dfb\u52a0\u663e\u5f0f\u52a8\u753b\u3002\\n\\n```swift\\nlet olderLayer = animationObjc.animatableLayerCopy(layer)\\nCATransaction.begin()\\nCATransaction.setDisableActions(true)\\nnewLayer = effectAnimationClosure(layer: layer)\\nCATransaction.commit()\\nvar animationGroup:CAAnimationGroup?\\nanimationGroup = groupAnimationWithLayerChanges(old: olderLayer, new: newLayer!)\\nlayer.addAnimation(textAniamtionGroup, forKey: textAnimationGroupKey)\\n\\n```\\n\\n## \u6536\u5de5\\n\\n\u597d\u4e86, \u5f53\u4e0a\u9762\u6240\u6709\u7684\u5de5\u4f5c\u5b8c\u6210\u4e4b\u540e, \u5c31\u662f\u6211\u4eec\u6700\u5f00\u59cb\u770b\u5230\u7684\u90a3\u4e2a\u6548\u679c, \u4ee3\u7801\u5df2\u7ecf\u4e0a\u4f20github, \u4f60\u53ef\u4ee5\u4ece[\u8fd9\u91cc](https://github.com/OnePieceLv/TextKitAndAnimationEffect.git)\u4e0b\u8f7d\u3002\u5176\u5b9e\u8fd9\u4e2ademo\u91cc\u5b9e\u73b0\u7684label\u8fd8\u6709\u5f88\u5927\u4f18\u5316\u7684\u7a7a\u95f4\u3002\u6bd4\u5982\u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u52a8\u753b\u6548\u679c, \u52a8\u753b\u6548\u679c\u53ef\u914d\u7f6e\u7b49\u7b49\u3002\u8fd9\u662f\u6211\u63a5\u4e0b\u6765\u6253\u7b97\u505a\u7684\u4e8b\u60c5\u3002\\n\u672c\u4eba\u624d\u758f\u5b66\u6d45, \u9519\u6f0f\u96be\u514d, \u6b22\u8fce\u5927\u5bb6\u6279\u8bc4\u6307\u6b63\u4ee5\u53ca pull request \uff1a\uff09\u3002\\n\\n## \u6700\u540e\\n\\n\u4e0d\u77e5\u4e0d\u89c9\u5de5\u4f5c\u8bb8\u591a\u5e74\u4e86, \u8fd9\u51e0\u5e74\u841d\u8389\u53d8\u6210\u4e86\u59d1\u5a18, \u59d1\u5a18\u53d8\u6210\u4e86\u5b69\u5b50\u5988\u3002\u5927\u5bb6\u4eceQQ\u7a7a\u95f4\u6740\u5230\u670b\u53cb\u5708\u3002\u4ece\u6652\u5973\u670b\u53cb, \u5230\u6652\u7ed3\u5a5a\u7167\u7ee7\u800c\u5230\u6652\u5a03\u3002\u8fd9\u51e0\u5e74\u9e23\u4eba\u540c\u5fd7\u90fd\u4e0d\u8d1f\u4f17\u671b\u5f53\u4e0a\u4e86\u706b\u5f71(\u4e2b\u4e5f\u4e0d\u8bf7\u5403\u996d)\u3002\u5927\u5bb6\u90fd\u5728\u53d1\u751f\u53d8\u5316\u3002\\n\u5b66\u4f1a\u5f00\u59cb\u5199\u70b9\u4e1c\u897f\u5206\u4eab\u53ef\u80fd\u662f\u6211\u60f3\u8981\u7684\u4e00\u4e2a\u53d8\u5316\u3002\\n\\n\u53c2\u8003\u8d44\u6599\uff1a\\n\\n- [RQShineLabel](https://github.com/zipme/RQShineLabel.git)\u8fd9\u4e2a\u4f5c\u8005\u662f\u76f4\u63a5\u5bf9\u5b57\u4f53\u7684alpha\u503c\u505a\u5c5e\u6027\u52a8\u753b\u3002\u6ca1\u6709\u7ed9\u5b57\u4f53\u505a\u91cd\u65b0\u5e03\u5c40\u3002\u52a8\u753b\u662f\u7528CADisplayLink\u5b9e\u73b0, \u8ddfLTMorphingLabel\u4e00\u6837\u3002\\n\\n- [TextEffects with NSLayoutManager](http://swiftyeti.com/texteffects-with-nslayoutmanager/)\\n\\n- [Advanced Text Layouts and Effects with Text Kit](https://developer.apple.com/videos/play/wwdc2013/220/)\\n\\n- [LTMorphingLabel](https://github.com/lexrus/LTMorphingLabel.git)"}]}')}}]);